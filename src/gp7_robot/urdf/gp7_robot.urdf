<?xml version="1.0" encoding="utf-8"?>
<!-- Merged GP7 URDF: DH-corrected geometry (from new export) + plugins,
     ros2_control, limits, dynamics, friction, and finger collisions from old tuned file. -->
<robot name="gp7_robot">

  <!-- Gazebo ROS 2 control plugin -->
  <gazebo>
    <plugin
      filename="libgz_ros2_control-system.so"
      name="gz_ros2_control::GazeboSimROS2ControlPlugin">
      <parameters>/home/kiran_gunathilaka/development/ros/robotic_manipulator_simulation/src/gp7_robot/config/gp7_controllers.yaml</parameters>
      <controller_manager_name>controller_manager</controller_manager_name>
      <hold_joints>true</hold_joints>
      <position_proportional_gain>0.1</position_proportional_gain>
    </plugin>
  </gazebo>

  <!-- ros2_control system hardware description -->
  <ros2_control name="GazeboSimSystem" type="system">
    <hardware>
      <plugin>gz_ros2_control/GazeboSimSystem</plugin>
    </hardware>
    <joint name="joint1">
      <command_interface name="position"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
      <state_interface name="effort"/>
    </joint>
    <joint name="joint2">
      <command_interface name="position"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
      <state_interface name="effort"/>
    </joint>
    <joint name="joint3">
      <command_interface name="position"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
      <state_interface name="effort"/>
    </joint>
    <joint name="joint4">
      <command_interface name="position"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
      <state_interface name="effort"/>
    </joint>
    <joint name="joint5">
      <command_interface name="position"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
      <state_interface name="effort"/>
    </joint>
    <joint name="joint6">
      <command_interface name="position"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
      <state_interface name="effort"/>
    </joint>
    <joint name="finger1_joint">
      <command_interface name="position"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
      <state_interface name="effort"/>
    </joint>
    <joint name="finger2_joint">
      <command_interface name="position"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
      <state_interface name="effort"/>
    </joint>
  </ros2_control>

  <!-- World frame -->
  <link name="world"/>
  <joint name="world_to_base" type="fixed">
    <parent link="world"/>
    <child link="base_link"/>
    <origin xyz="0 0 0" rpy="0 0 0"/>
  </joint>

  <!-- BASE LINK -->
  <link name="base_link">
    <inertial>
      <origin xyz="-0.0061643 6.0941E-07 0.083158" rpy="0 0 0" />
      <mass value="5.2154" />
      <inertia
        ixx="0.026026"
        ixy="-2.5924E-05"
        ixz="0.00013984"
        iyy="0.025295"
        iyz="-4.7677E-05"
        izz="0.021721" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://gp7_robot/meshes/base_link.STL" />
      </geometry>
      <material name="">
        <color rgba="1 0 0 1" />
      </material>
    </visual>
    <!-- Use mesh as approximate convex collision -->
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://gp7_robot/meshes/base_link.STL" />
      </geometry>
    </collision>
  </link>

  <!-- LINK 1 -->
  <link name="link1">
    <inertial>
      <origin xyz="0.015672 2.2615E-06 0.095449" rpy="0 0 0" />
      <mass value="2.9447" />
      <inertia
        ixx="0.011181"
        ixy="-4.9786E-06"
        ixz="-0.0021792"
        iyy="0.011947"
        iyz="-1.7792E-05"
        izz="0.0088687" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://gp7_robot/meshes/link1.STL" />
      </geometry>
      <material name="">
        <color rgba="0 1 0 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://gp7_robot/meshes/link1.STL" />
      </geometry>
    </collision>
  </link>

  <joint name="joint1" type="revolute">
    <origin xyz="-0.00059534 0 0.1829" rpy="0 0 0" />
    <parent link="base_link" />
    <child link="link1" />
    <axis xyz="0 0 1" />
    <!-- S axis: ±170°, 375 °/s -->
    <limit
      lower="-2.96706"
      upper="2.96706"
      effort="200"
      velocity="6.54499" />
    <dynamics damping="0.1" friction="0.05"/>
  </joint>

  <!-- LINK 2 -->
  <link name="link2">
    <inertial>
      <origin xyz="0.027625 0.19499 0.00020191" rpy="0 0 0" />
      <mass value="6.2405" />
      <inertia
        ixx="0.1263"
        ixy="0.00019256"
        ixz="4.291E-05"
        iyy="0.027757"
        iyz="-0.00048284"
        izz="0.11052" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://gp7_robot/meshes/link2.STL" />
      </geometry>
      <material name="">
        <color rgba="0 0 1 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://gp7_robot/meshes/link2.STL" />
      </geometry>
    </collision>
  </link>

  <joint name="joint2" type="revolute">
    <origin xyz="0.039998 0.00034906 0.1355" rpy="1.5708 0 -3.1329" />
    <parent link="link1" />
    <child link="link2" />
    <axis xyz="0 0 1" />
    <!-- L axis: +145° / -65°, 315 °/s -->
    <limit
      lower="-1.13446"
      upper="2.53073"
      effort="200"
      velocity="5.49779" />
    <dynamics damping="0.1" friction="0.05"/>
  </joint>

  <!-- LINK 3 -->
  <link name="link3">
    <inertial>
      <origin xyz="-0.020055 0.015909 -0.00085391" rpy="0 0 0" />
      <mass value="2.8492" />
      <inertia
        ixx="0.0069342"
        ixy="-0.00090367"
        ixz="3.8644E-05"
        iyy="0.0082319"
        iyz="-2.8966E-05"
        izz="0.0077915" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://gp7_robot/meshes/link3.STL" />
      </geometry>
      <material name="">
        <color rgba="1 1 0 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://gp7_robot/meshes/link3.STL" />
      </geometry>
    </collision>
  </link>

  <joint name="joint3" type="revolute">
    <origin xyz="0 0.445 0" rpy="0 0 -1.5708" />
    <parent link="link2" />
    <child link="link3" />
    <axis xyz="0 0 1" />
    <!-- U axis: +190° / -70°, 410 °/s -->
    <limit
      lower="-1.22173"
      upper="3.31613"
      effort="200"
      velocity="7.15585" />
    <dynamics damping="0.1" friction="0.05"/>
  </joint>

  <!-- LINK 4 -->
  <link name="link4">
    <inertial>
      <!-- from new export (DH-corrected) -->
      <origin xyz="0.00015216 -0.00046619 0.24576" rpy="0 0 0" />
      <mass value="2.7554" />
      <inertia
        ixx="0.010085"
        ixy="-2.488E-06"
        ixz="-4.0001E-06"
        iyy="0.010785"
        iyz="0.00031861"
        izz="0.0030857" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://gp7_robot/meshes/link4.STL" />
      </geometry>
      <material name="">
        <color rgba="1 0 1 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://gp7_robot/meshes/link4.STL" />
      </geometry>
    </collision>
  </link>

  <joint name="joint4" type="revolute">
    <!-- origin from DH-corrected export -->
    <origin xyz="-0.04 0 0.00062392" rpy="1.5708 0 0" />
    <parent link="link3" />
    <child link="link4" />
    <axis xyz="0 0 1" />
    <!-- R axis: ±190°, 550 °/s -->
    <limit
      lower="-3.31613"
      upper="3.31613"
      effort="17"
      velocity="9.59931" />
    <dynamics damping="0.1" friction="0.05"/>
  </joint>

  <!-- LINK 5 -->
  <link name="link5">
    <inertial>
      <!-- from new export (DH-corrected) -->
      <origin xyz="-0.00025391 -0.01321 -0.0017485" rpy="0 0 0" />
      <mass value="0.24589" />
      <inertia
        ixx="0.00013953"
        ixy="-2.1177E-06"
        ixz="-1.9619E-07"
        iyy="0.00015684"
        iyz="1.2921E-06"
        izz="0.00018562" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://gp7_robot/meshes/link5.STL" />
      </geometry>
      <material name="">
        <color rgba="0 1 1 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://gp7_robot/meshes/link5.STL" />
      </geometry>
    </collision>
  </link>

  <joint name="joint5" type="revolute">
    <!-- origin from DH-corrected export -->
    <origin xyz="0 -0.00062392 0.43999" rpy="-1.5708 0 0" />
    <parent link="link4" />
    <child link="link5" />
    <axis xyz="0 0 1" />
    <!-- B axis: ±135°, 550 °/s -->
    <limit
      lower="-2.35619"
      upper="2.35619"
      effort="17"
      velocity="9.59931" />
    <dynamics damping="0.1" friction="0.05"/>
  </joint>

  <!-- END-EFFECTOR LINK -->
  <link name="EE">
    <inertial>
      <!-- from new export (DH-corrected) -->
      <origin xyz="-2.3469E-05 3.8273E-05 -0.10091" rpy="0 0 0" />
      <mass value="0.13667" />
      <inertia
        ixx="5.3828E-05"
        ixy="1.8623E-07"
        ixz="3.6556E-08"
        iyy="5.2643E-05"
        iyz="-2.5485E-07"
        izz="5.4993E-05" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://gp7_robot/meshes/EE.STL" />
      </geometry>
      <material name="">
        <color rgba="1 0 0 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://gp7_robot/meshes/EE.STL" />
      </geometry>
    </collision>
  </link>

  <joint name="joint6" type="continuous">
    <!-- origin from DH-corrected export -->
    <origin xyz="0 0 0" rpy="-1.5708 0 0" />
    <parent link="link5" />
    <child link="EE" />
    <axis xyz="0 0 1" />
    <!-- T axis: ±360°, 1000 °/s -->
    <limit
      lower="-6.28318"
      upper="6.28318"
      effort="10"
      velocity="17.4533" />
    <dynamics damping="0.1" friction="0.05"/>
  </joint>

  <!-- FINGER 1 -->
  <link name="finger1_link">
    <inertial>
      <origin xyz="0.014816 -0.016407 -0.0019684" rpy="0 0 0" />
      <mass value="0.0047666" />
      <inertia
        ixx="3.8954E-07"
        ixy="-4.7932E-08"
        ixz="6.1802E-09"
        iyy="8.1996E-07"
        iyz="5.3332E-08"
        izz="1.1669E-06" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://gp7_robot/meshes/finger1_link.STL" />
      </geometry>
      <material name="">
        <color rgba="0 0 1 1" />
      </material>
    </visual>
    <!-- Primitive box collision for stable contacts -->
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <!-- approximate dimensions of finger -->
        <box size="0.015 0.01 0.04"/>
      </geometry>
    </collision>
  </link>

  <joint name="finger1_joint" type="revolute">
    <!-- keep DH-corrected EE frame; use tuned axis/limits -->
    <origin xyz="-0.0074919 0.012828 -0.1675" rpy="-1.5708 1.5621 1.5708" />
    <parent link="EE" />
    <child link="finger1_link" />
    <!-- using axis from new export would be this: -->
    <axis xyz="0.0012983 0.14877 0.98887" />
    <limit
      lower="-1"
      upper="0.5"
      effort="10"
      velocity="2.0" />
    <dynamics damping="0.1" friction="0.05"/>
  </joint>

  <!-- FINGER 2 -->
  <link name="finger2_link">
    <inertial>
      <origin xyz="0.01644 0.012607 -0.0063313" rpy="0 0 0" />
      <mass value="0.0047666" />
      <inertia
        ixx="4.2266E-07"
        ixy="1.255E-07"
        ixz="-1.9868E-08"
        iyy="7.8764E-07"
        iyz="5.8423E-08"
        izz="1.1661E-06" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://gp7_robot/meshes/finger2_link.STL" />
      </geometry>
      <material name="">
        <color rgba="0 0 1 1" />
      </material>
    </visual>
    <!-- Primitive box collision for stable contacts -->
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <!-- approximate dimensions of finger -->
        <box size="0.015 0.01 0.04"/>
      </geometry>
    </collision>
  </link>

  <joint name="finger2_joint" type="revolute">
    <!-- keep DH-corrected EE frame; use tuned limits -->
    <origin xyz="-0.0033856 -0.014465 -0.1675" rpy="-1.5708 1.5621 1.5708" />
    <parent link="EE" />
    <child link="finger2_link" />
    <axis xyz="-0.0012983 -0.14877 -0.98887" />
    <limit
      lower="-1"
      upper="0.5"
      effort="10"
      velocity="2.0" />
    <dynamics damping="0.1" friction="0.05"/>
  </joint>

  <!-- Enable self-collision for fingers so they can't pass through each other -->
  <gazebo reference="finger1_link">
    <self_collide>true</self_collide>
  </gazebo>
  <gazebo reference="finger2_link">
    <self_collide>true</self_collide>
  </gazebo>

</robot>